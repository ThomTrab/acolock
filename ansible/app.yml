---
- hosts: pi
  remote_user: pi

  tasks:
  - name: build front
    local_action: command bash -c "cd ../front && yarn && yarn run build"
  - name: deploy front
    synchronize:
      src: ../front/build/
      dest: /home/pi/front/
  - name: deploy back
    synchronize:
      src: ../back/
      dest: /home/pi/back/
    notify:
      - restart back
  - name: setup back
    shell: /home/pi/back/setup_environment

  - name: Ensure socket is running
    become: yes
    service:
      name: acolock_back.socket
      state: started

  handlers:
  - name: restart back
    become: yes
    service:
      name: acolock_back.service
      state: restarted
